import{r as x,j as l}from"./index-BXlzWtmz.js";import{C as T}from"./index-4UvrGvMa.js";import{C as A}from"./CardMovie-Wbf2UTDs.js";import{u as N}from"./useFecthMovieDetails-Dg6EVaj3.js";import"./Banner-BSbX8Ozt.js";import"./useVisibility-93C1PPf2.js";const I=(e,t)=>t.some(n=>e instanceof n);let P,v;function O(){return P||(P=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function F(){return v||(v=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const w=new WeakMap,D=new WeakMap,h=new WeakMap;function V(e){const t=new Promise((n,r)=>{const i=()=>{e.removeEventListener("success",a),e.removeEventListener("error",o)},a=()=>{n(f(e.result)),i()},o=()=>{r(e.error),i()};e.addEventListener("success",a),e.addEventListener("error",o)});return h.set(t,e),t}function L(e){if(w.has(e))return;const t=new Promise((n,r)=>{const i=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=()=>{n(),i()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)});w.set(e,t)}let p={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return w.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function j(e){p=e(p)}function W(e){return F().includes(e)?function(...t){return e.apply(B(this),t),f(this.request)}:function(...t){return f(e.apply(B(this),t))}}function _(e){return typeof e=="function"?W(e):(e instanceof IDBTransaction&&L(e),I(e,O())?new Proxy(e,p):e)}function f(e){if(e instanceof IDBRequest)return V(e);if(D.has(e))return D.get(e);const t=_(e);return t!==e&&(D.set(e,t),h.set(t,e)),t}const B=e=>h.get(e);function K(e,t,{blocked:n,upgrade:r,blocking:i,terminated:a}={}){const o=indexedDB.open(e,t),d=f(o);return r&&o.addEventListener("upgradeneeded",s=>{r(f(o.result),s.oldVersion,s.newVersion,f(o.transaction),s)}),n&&o.addEventListener("blocked",s=>n(s.oldVersion,s.newVersion,s)),d.then(s=>{a&&s.addEventListener("close",()=>a()),i&&s.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),d}const R=["get","getKey","getAll","getAllKeys","count"],$=["put","add","delete","clear"],b=new Map;function C(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(b.get(t))return b.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=$.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||R.includes(n)))return;const a=async function(o,...d){const s=this.transaction(o,i?"readwrite":"readonly");let c=s.store;return r&&(c=c.index(d.shift())),(await Promise.all([c[n](...d),i&&s.done]))[0]};return b.set(t,a),a}j(e=>({...e,get:(t,n,r)=>C(t,n)||e.get(t,n,r),has:(t,n)=>!!C(t,n)||e.has(t,n)}));const H=["continue","continuePrimaryKey","advance"],S={},M=new WeakMap,k=new WeakMap,z={get(e,t){if(!H.includes(t))return e[t];let n=S[t];return n||(n=S[t]=function(...r){M.set(this,k.get(this)[t](...r))}),n}};async function*G(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,z);for(k.set(n,t),h.set(n,B(t));t;)yield n,t=await(M.get(n)||t.continue()),M.delete(n)}function g(e,t){return t===Symbol.asyncIterator&&I(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&I(e,[IDBIndex,IDBObjectStore])}j(e=>({...e,get(t,n,r){return g(t,n)?G:e.get(t,n,r)},has(t,n){return g(t,n)||e.has(t,n)}}));const J="MoviesDB-Home",m="movies-home";async function Q(){return K(J,1,{upgrade(e){e.objectStoreNames.contains(m)||e.createObjectStore(m,{keyPath:"key"})}})}function te({URL:e,title:t,isLarge:n,language:r}){const[i,a]=x.useState([]),{movies:o}=N(e,2,r,["videos","images","credits"]);x.useEffect(()=>{(async()=>{const u=await Q(),y=`${e}_${r}`,E=await u.get(m,y);E?(a(E.data),console.log("cargando datos de idb")):o.length>0&&(console.log("cargando datos de api"),await u.put(m,{key:y,data:o}),a(o))})()},[e,r,o]);const d={desktop:{breakpoint:{max:3e3,min:1281},items:n?5:8,slidesToSlide:n?3:6},tablet:{breakpoint:{max:1280,min:769},items:n?4:6,slidesToSlide:n?3:4},mobileLarge:{breakpoint:{max:768,min:481},items:n?3:4,slidesToSlide:2},mobileSmall:{breakpoint:{max:480,min:0},items:2,slidesToSlide:1}},s=c=>c.map(u=>(n?u.backdrop_path:u.poster_path)?l.jsx(A,{movie:u,isLarge:n,language:r},u.id):null);return l.jsxs("div",{className:"carousel",children:[l.jsx("h2",{className:"tituloCarousel",children:t}),l.jsx(T,{swipeable:!1,draggable:!1,showDots:!1,responsive:d,ssr:!0,infinite:!0,autoPlay:!1,className:"carousel-react",children:s(i)})]})}export{te as default};

import{r as t,b,j as s,e as N,f as B,u as M,c as T,a as L,g as C,h as R}from"./index-Dbv0Nxsg.js";import{B as $,A as F,g as A}from"./endPoints-D6Ym8Q8U.js";import{C as q}from"./CardMovie-VYIa1dtr.js";import{N as g}from"./NavBar-Cen6X4bT.js";import{u as x}from"./useQuery-Bh4W8dDL.js";import{f as _}from"./fetchData-DCFA1qTy.js";const z=t.memo(({placeholder:i,onSubmit:l})=>{const{searchTerm:f,setSearchTerm:d}=b(),a=t.useRef(null),e=t.useRef(null),[r,m]=t.useState(f);return t.useEffect(()=>{a.current&&a.current.focus()},[]),t.useEffect(()=>(e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{d(r),l(r)},1e3),()=>{e.current&&clearTimeout(e.current)}),[r]),s.jsx("form",{id:"busqueda",className:"flex items-center w-full",onSubmit:u=>u.preventDefault(),children:s.jsxs("div",{className:"relative w-full item",children:[s.jsx("input",{ref:a,id:"busqueda-input",type:"text",className:"lupa bg-black border p-2 border-gray-300 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:i,value:r,onChange:u=>m(u.target.value)}),s.jsx("button",{type:"submit",style:{display:"none"}})]})})});function Y(){const{searchTerm:i,setSearchTerm:l}=b(),f=N(),{language:d}=B(),{currentPerfil:a,currentUser:e}=M(),[r,m]=t.useState(window.innerWidth);t.useEffect(()=>{window.scroll({top:0,left:0,behavior:"instant"})});const{setOpenMenu:u}=T();t.useEffect(()=>{const o=()=>m(window.innerWidth);return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),t.useEffect(()=>{i===""&&r>=900&&f("/home",{state:{fromBuscar:!0}})},[i,r]),t.useEffect(()=>{u(!1)},[]);const p=L(),v=t.useCallback(o=>{o!==i&&l(o)},[i,l]);x(`favorites-${e==null?void 0:e.id}-${a==null?void 0:a.id}`,()=>C(e==null?void 0:e.id,a==null?void 0:a.id),{enabled:!!(e!=null&&e.id)&&!!(a!=null&&a.id)});const j=t.useCallback(async o=>{await R(e==null?void 0:e.id,a==null?void 0:a.id,o),await p.invalidateQueries(`favorites-${e==null?void 0:e.id}-${a==null?void 0:a.id}`)},[e==null?void 0:e.id,a==null?void 0:a.id,p]),w=t.useMemo(()=>i?`${$}/search/movie?api_key=${F}&language=${d}&query=${i}`:A(d).popularMovies,[i,d]),{data:n,isLoading:y}=x([i||"popularMovies"],()=>_(w)),h=t.useMemo(()=>{var o;return(o=n==null?void 0:n.results)==null?void 0:o.filter(c=>c.backdrop_path&&c.poster_path)},[n==null?void 0:n.results]);if(y)return s.jsx(s.Fragment,{children:s.jsx("div",{className:"contenedor",children:s.jsx(g,{logoBuscar:!0,menu:!0,perfil:!0,condicionExpanded:!0})})});const E=o=>o.map((c,k)=>s.jsx(q,{movie:c,onAddFavorite:()=>j(c)},k)),S=()=>{if(h.length>0)return s.jsx("div",{className:"contenedorPeliculasBuscar",children:E(h)});if(h.length==0)return s.jsx(s.Fragment,{children:s.jsx("div",{className:"contenedorPeliculasNoE",children:s.jsxs("p",{children:["La busqueda de ",i," no arrroj√≥ coincidencias."]})})})};return s.jsxs("div",{className:"contenedor",children:[s.jsx(g,{perfil:!0,menu:!0,logoBuscar:!0,condicionExpanded:!0}),s.jsxs("div",{className:"contenedorBuscar",children:[r<900&&s.jsx(z,{placeholder:"Search Movies",onSubmit:v}),S()]})]})}export{Y as default};

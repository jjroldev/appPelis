import{r as t,b as v,j as s,e as k,f as B,u as T,c as L,a as M,g as R,h as $}from"./index-CwWRJurO.js";import{B as C,A as F,g as A}from"./endPoints-D6Ym8Q8U.js";import{C as q}from"./CardMovie-UZ7oZT1M.js";import{N as p}from"./NavBar-D5E6lsah.js";import{u as g}from"./useQuery-ZUUM_uA9.js";import{f as _}from"./fetchData-DCFA1qTy.js";const z=t.memo(({placeholder:o,onSubmit:c})=>{const{searchTerm:f,setSearchTerm:l}=v(),a=t.useRef(null),e=t.useRef(null),[n,m]=t.useState(f);return t.useEffect(()=>{a.current&&a.current.focus()},[]),t.useEffect(()=>(e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{l(n),c(n)},1e3),()=>{e.current&&clearTimeout(e.current)}),[n]),s.jsx("form",{id:"busqueda",className:"flex items-center w-full",onSubmit:u=>u.preventDefault(),children:s.jsxs("div",{className:"relative w-full item",children:[s.jsx("input",{ref:a,id:"busqueda-input",type:"text",className:"lupa bg-black border p-2 border-gray-300 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:o,value:n,onChange:u=>m(u.target.value)}),s.jsx("button",{type:"submit",style:{display:"none"}})]})})});function Y(){const{searchTerm:o,setSearchTerm:c}=v(),f=k(),{language:l}=B(),{currentPerfil:a,currentUser:e}=T(),[n,m]=t.useState(window.innerWidth);t.useEffect(()=>{window.scroll({top:0,left:0,behavior:"instant"})});const{setOpenMenu:u}=L();t.useEffect(()=>{const r=()=>m(window.innerWidth);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),t.useEffect(()=>{o===""&&n>=900&&f("/home",{state:{fromBuscar:!0}})},[o,n]),t.useEffect(()=>{u(!1)},[]);const x=M(),b=t.useCallback(r=>{c(r)},[c]);g(`favorites-${e==null?void 0:e.id}-${a==null?void 0:a.id}`,()=>R(e==null?void 0:e.id,a==null?void 0:a.id),{enabled:!!(e!=null&&e.id)&&!!(a!=null&&a.id)});const j=async r=>{await $(e==null?void 0:e.id,a==null?void 0:a.id,r),await x.invalidateQueries(`favorites-${e==null?void 0:e.id}-${a==null?void 0:a.id}`)},w=o?`${C}/search/movie?api_key=${F}&language=${l}&query=${o}`:A(l).popularMovies,{data:i,isLoading:y}=g([o||"popularMovies"],()=>_(w)),h=t.useMemo(()=>{var r;return(r=i==null?void 0:i.results)==null?void 0:r.filter(d=>d.backdrop_path&&d.poster_path)},[i==null?void 0:i.results]);if(y)return s.jsx(s.Fragment,{children:s.jsx("div",{className:"contenedor",children:s.jsx(p,{logoBuscar:!0,menu:!0,perfil:!0,condicionExpanded:!0})})});const E=r=>r.map((d,N)=>s.jsx(q,{movie:d,onAddFavorite:()=>j(d)},N)),S=()=>{if(h.length>0)return s.jsx("div",{className:"contenedorPeliculasBuscar",children:E(h)});if(h.length==0)return s.jsx(s.Fragment,{children:s.jsx("div",{className:"contenedorPeliculasNoE",children:s.jsxs("p",{children:["La busqueda de ",o," no arrroj√≥ coincidencias."]})})})};return s.jsxs("div",{className:"contenedor",children:[s.jsx(p,{perfil:!0,menu:!0,logoBuscar:!0,condicionExpanded:!0}),s.jsxs("div",{className:"contenedorBuscar",children:[n<900&&s.jsx(z,{placeholder:"Search Movies",onSubmit:b}),S()]})]})}export{Y as default};

import{R as A,r as m,j as l}from"./index-CW8X7TER.js";import{C as N}from"./index-Ce_ieSbo.js";import{C as O}from"./CardMovie-CN5tHRm-.js";import{u as F}from"./useFecthMovieDetails-CPTmDBrY.js";import"./useVisibility-XgSgO_sf.js";import"./Banner-DOBYK4ZJ.js";const I=(e,t)=>t.some(n=>e instanceof n);let v,C;function V(){return v||(v=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function W(){return C||(C=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const w=new WeakMap,b=new WeakMap,y=new WeakMap;function R(e){const t=new Promise((n,o)=>{const i=()=>{e.removeEventListener("success",a),e.removeEventListener("error",s)},a=()=>{n(f(e.result)),i()},s=()=>{o(e.error),i()};e.addEventListener("success",a),e.addEventListener("error",s)});return y.set(t,e),t}function _(e){if(w.has(e))return;const t=new Promise((n,o)=>{const i=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",s),e.removeEventListener("abort",s)},a=()=>{n(),i()},s=()=>{o(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",a),e.addEventListener("error",s),e.addEventListener("abort",s)});w.set(e,t)}let M={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return w.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function T(e){M=e(M)}function K(e){return W().includes(e)?function(...t){return e.apply(B(this),t),f(this.request)}:function(...t){return f(e.apply(B(this),t))}}function L(e){return typeof e=="function"?K(e):(e instanceof IDBTransaction&&_(e),I(e,V())?new Proxy(e,M):e)}function f(e){if(e instanceof IDBRequest)return R(e);if(b.has(e))return b.get(e);const t=L(e);return t!==e&&(b.set(e,t),y.set(t,e)),t}const B=e=>y.get(e);function $(e,t,{blocked:n,upgrade:o,blocking:i,terminated:a}={}){const s=indexedDB.open(e,t),c=f(s);return o&&s.addEventListener("upgradeneeded",r=>{o(f(s.result),r.oldVersion,r.newVersion,f(s.transaction),r)}),n&&s.addEventListener("blocked",r=>n(r.oldVersion,r.newVersion,r)),c.then(r=>{a&&r.addEventListener("close",()=>a()),i&&r.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const H=["get","getKey","getAll","getAllKeys","count"],z=["put","add","delete","clear"],p=new Map;function S(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(p.get(t))return p.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,i=z.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(i||H.includes(n)))return;const a=async function(s,...c){const r=this.transaction(s,i?"readwrite":"readonly");let d=r.store;return o&&(d=d.index(c.shift())),(await Promise.all([d[n](...c),i&&r.done]))[0]};return p.set(t,a),a}T(e=>({...e,get:(t,n,o)=>S(t,n)||e.get(t,n,o),has:(t,n)=>!!S(t,n)||e.has(t,n)}));const G=["continue","continuePrimaryKey","advance"],j={},E=new WeakMap,g=new WeakMap,J={get(e,t){if(!G.includes(t))return e[t];let n=j[t];return n||(n=j[t]=function(...o){E.set(this,g.get(this)[t](...o))}),n}};async function*Q(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,J);for(g.set(n,t),y.set(n,B(t));t;)yield n,t=await(E.get(n)||t.continue()),E.delete(n)}function k(e,t){return t===Symbol.asyncIterator&&I(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&I(e,[IDBIndex,IDBObjectStore])}T(e=>({...e,get(t,n,o){return k(t,n)?Q:e.get(t,n,o)},has(t,n){return k(t,n)||e.has(t,n)}}));const X="MoviesDB-Home",h="movies-home",Y=async()=>$(X,1,{upgrade(e){e.objectStoreNames.contains(h)||e.createObjectStore(h,{keyPath:"key"})}}),oe=A.memo(({URL:e,title:t,isLarge:n,language:o})=>{const[i,a]=m.useState([]),s=m.useMemo(()=>["videos","images","credits"],[]),{movies:c}=F(e,2,o,s);m.useEffect(()=>{(async()=>{const u=await Y(),D=`${e}_${o}`,P=await u.get(h,D);P?(a(P.data),console.log("cargando datos de idb")):c.length>0&&(console.log("cargando datos de api"),await u.put(h,{key:D,data:c}),a(c))})()},[e,o,c]);const r=m.useCallback(x=>x.map(u=>(n?u.backdrop_path:u.poster_path)?l.jsx(O,{movie:u,isLarge:n,language:o},u.id):null),[n,o]),d=m.useMemo(()=>({desktop:{breakpoint:{max:3e3,min:1281},items:n?5:8,slidesToSlide:n?4:7},tablet:{breakpoint:{max:1280,min:769},items:n?4:6,slidesToSlide:n?3:5},mobileLarge:{breakpoint:{max:768,min:481},items:n?3:4,slidesToSlide:n?2:3},mobileSmall:{breakpoint:{max:480,min:0},items:2,slidesToSlide:1}}),[n]);return l.jsxs("div",{className:"carousel",children:[l.jsx("h2",{className:"tituloCarousel",children:t}),l.jsx(N,{swipeable:!1,draggable:!1,showDots:!1,responsive:d,ssr:!0,infinite:!0,autoPlay:!1,className:"carousel-react",children:r(i)})]})});export{oe as default};

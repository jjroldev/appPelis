import{r as t,b as x,j as a,e as M,a as T,f as B,u as L,c as C,g as R,h as $}from"./index-CY5tKcRL.js";import{u as p}from"./useQuery-D-Cck4BY.js";import{B as A,A as q,g as F}from"./endPoints-D6Ym8Q8U.js";import{f as _}from"./fetchData-DCFA1qTy.js";import{N as v}from"./NavBar-JcPRDVbz.js";import{C as k}from"./CardMovie-By7W4L-f.js";const z=t.memo(({placeholder:r,onSubmit:l})=>{const{searchTerm:o,setSearchTerm:m}=x(),n=t.useRef(null),e=t.useRef(null),[s,f]=t.useState(o);return t.useEffect(()=>{n.current&&n.current.focus()},[]),t.useEffect(()=>(e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{o!==s&&(m(s),l(s))},1e3),()=>{e.current&&clearTimeout(e.current)}),[s]),a.jsx("form",{id:"busqueda",onSubmit:d=>d.preventDefault(),children:a.jsxs("div",{className:"contenedorLupa",children:[a.jsx("input",{ref:n,id:"busqueda-input",type:"text",className:"lupaMovile",placeholder:r,value:s,onChange:d=>f(d.target.value)}),a.jsx("i",{className:"fa-solid fa-magnifying-glass lupaIcono"}),a.jsx("button",{type:"submit",style:{display:"none"}})]})})});function Y(){const r=M(),l=T(),{searchTerm:o,setSearchTerm:m}=x(),{language:n}=B(),{currentPerfil:e,currentUser:s}=L(),{setOpenMenu:f}=C(),[d,g]=t.useState(window.innerWidth);t.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[]),t.useEffect(()=>{const i=()=>g(window.innerWidth);return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]),t.useEffect(()=>{o===""&&d>=900&&r("/home",{state:{fromBuscar:!0}})},[o,d,r]),t.useEffect(()=>{f(!1)},[f]);const j=t.useCallback(i=>{i!==o&&m(i)},[o,m]);p(`favorites-${s==null?void 0:s.id}-${e==null?void 0:e.id}`,()=>R(s==null?void 0:s.id,e==null?void 0:e.id),{enabled:!!(s!=null&&s.id)&&!!(e!=null&&e.id)});const E=t.useCallback(async i=>{await $(s==null?void 0:s.id,e==null?void 0:e.id,i),await l.invalidateQueries(`favorites-${s==null?void 0:s.id}-${e==null?void 0:e.id}`)},[s==null?void 0:s.id,e==null?void 0:e.id,l]),b=t.useMemo(()=>o?`${A}/search/movie?api_key=${q}&language=${n}&query=${o}`:F(n).popularMovies,[o,n]),{data:c,isLoading:w}=p([o||"popularMovies"],()=>_(b)),h=t.useMemo(()=>{var i;return(i=c==null?void 0:c.results)==null?void 0:i.filter(u=>u.backdrop_path&&u.poster_path)},[c==null?void 0:c.results]);if(w)return a.jsx("div",{className:"contenedor",children:a.jsx(v,{logoBuscar:!0,menu:!0,perfil:!0,condicionExpanded:!0})});const S=i=>i.map((u,N)=>a.jsx(k,{movie:u,onAddFavorite:()=>E(u)},N)),y=()=>h.length>0?a.jsx("div",{className:"contenedorPeliculasBuscar",children:S(h)}):a.jsx("div",{className:"contenedorPeliculasNoE",children:a.jsxs("p",{children:["La búsqueda de ",o," no arrojó coincidencias."]})});return a.jsxs("div",{className:"contenedor",children:[a.jsx(v,{perfil:!0,menu:!0,logoBuscar:!0,condicionExpanded:!0}),a.jsxs("div",{className:"contenedorBuscar",children:[d<900&&a.jsx(z,{placeholder:"Search Movies",onSubmit:j}),y()]})]})}export{Y as default};

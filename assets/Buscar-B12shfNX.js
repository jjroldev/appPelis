import{r as o,a as $,j as t,d as q,e as w,f as A,u as F,b as I,c as v,g as Q,h as W}from"./index-CmXgx7D_.js";import{B as S,A as b,g as K,a as O,C as Y}from"./CardItem-Bcx_Fy3P.js";import{f as y}from"./fetchData-DCFA1qTy.js";import{u as z,B as M}from"./BarMenu-L8R-98h6.js";const G=o.memo(({placeholder:l,onSubmit:h})=>{const{searchTerm:a,setSearchTerm:m}=$(),i=o.useRef(null),e=o.useRef(null),[s,f]=o.useState(a);return o.useEffect(()=>{i.current&&i.current.focus()},[]),o.useEffect(()=>(e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{a!==s&&(m(s),h(s))},1e3),()=>{e.current&&clearTimeout(e.current)}),[s]),t.jsx("form",{id:"busqueda",onSubmit:c=>c.preventDefault(),children:t.jsxs("div",{className:"contenedorLupa",children:[t.jsx("input",{ref:i,id:"busqueda-input",type:"text",className:"lupaMovile",placeholder:l,value:s,onChange:c=>f(c.target.value)}),t.jsx("i",{className:"fa-solid fa-magnifying-glass lupaIcono"}),t.jsx("button",{type:"submit",style:{display:"none"}})]})})});function Z(){const l=q(),h=w(),{searchTerm:a,setSearchTerm:m}=$(),{language:i}=A(),{currentPerfil:e,currentUser:s}=F(),{setOpenMenu:f}=I(),c=z();o.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[]),o.useEffect(()=>{a===""&&c>=900&&l(-1)},[a,c,l]),o.useEffect(()=>{f(!1)},[f]);const L=o.useCallback(n=>{n!==a&&m(n)},[a,m]);v(`favorites-${s==null?void 0:s.id}-${e==null?void 0:e.id}`,()=>Q(s==null?void 0:s.id,e==null?void 0:e.id),{enabled:!!(s!=null&&s.id)&&!!(e!=null&&e.id)});const R=o.useCallback(async n=>{await W(s==null?void 0:s.id,e==null?void 0:e.id,n),await h.invalidateQueries(`favorites-${s==null?void 0:s.id}-${e==null?void 0:e.id}`)},[s==null?void 0:s.id,e==null?void 0:e.id,h]),T=o.useMemo(()=>a?`${S}/search/movie?api_key=${b}&language=${i}&query=${a}`:K(i).topRatedMovies,[a,i]),E=o.useMemo(()=>a?`${S}/search/tv?api_key=${b}&language=${i}&query=${a}`:O(i).topRatedSeries,[a,i]),{data:d,isLoading:N}=v([a,"search-movies"],()=>y(T)),{data:u,isLoading:B}=v([a,"search-series"],()=>y(E)),C=N||B,x=o.useMemo(()=>{var g,j;const n=((g=d==null?void 0:d.results)==null?void 0:g.filter(r=>r.backdrop_path&&r.poster_path))||[],p=((j=u==null?void 0:u.results)==null?void 0:j.filter(r=>r.backdrop_path&&r.poster_path))||[];return[...n,...p].sort(()=>Math.random()-.5)},[d==null?void 0:d.results,u==null?void 0:u.results]);if(C)return t.jsx("div",{className:"contenedor",children:t.jsx(M,{})});const _=n=>n.map((p,g)=>t.jsx(Y,{item:p,onAddFavorite:()=>R(p)},g)),k=()=>x.length>0?t.jsx("div",{className:"contenedorItemsBuscar",children:_(x)}):t.jsx("div",{className:"contenedorItemsNoE",children:t.jsxs("p",{children:["La búsqueda de ",a," no arrojó coincidencias."]})});return t.jsxs("div",{className:"contenedor",children:[t.jsx(M,{}),t.jsxs("div",{className:"contenedorBuscar",children:[c<900&&t.jsx(G,{placeholder:"Search movies, series, tv series...",onSubmit:L}),k()]})]})}export{Z as default};

import{r as o,a as N,j as t,c as q,d as w,e as A,u as F,b as I,g as Q,f as W}from"./index-I0KVTuNB.js";import{u as v}from"./useQuery-GHSVvEtE.js";import{B as S,A as b,g as K,a as O,C as Y}from"./CardItem-BddEjgw-.js";import{f as y}from"./fetchData-DCFA1qTy.js";import{u as z,N as E}from"./NavBar-DmpPlhS9.js";const G=o.memo(({placeholder:l,onSubmit:m})=>{const{searchTerm:a,setSearchTerm:h}=N(),i=o.useRef(null),e=o.useRef(null),[s,f]=o.useState(a);return o.useEffect(()=>{i.current&&i.current.focus()},[]),o.useEffect(()=>(e.current&&clearTimeout(e.current),e.current=setTimeout(()=>{a!==s&&(h(s),m(s))},1e3),()=>{e.current&&clearTimeout(e.current)}),[s]),t.jsx("form",{id:"busqueda",onSubmit:c=>c.preventDefault(),children:t.jsxs("div",{className:"contenedorLupa",children:[t.jsx("input",{ref:i,id:"busqueda-input",type:"text",className:"lupaMovile",placeholder:l,value:s,onChange:c=>f(c.target.value)}),t.jsx("i",{className:"fa-solid fa-magnifying-glass lupaIcono"}),t.jsx("button",{type:"submit",style:{display:"none"}})]})})});function D(){const l=q(),m=w(),{searchTerm:a,setSearchTerm:h}=N(),{language:i}=A(),{currentPerfil:e,currentUser:s}=F(),{setOpenMenu:f}=I(),c=z();o.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[]),o.useEffect(()=>{a===""&&c>=900&&l("/home",{state:{fromBuscar:!0}})},[a,c,l]),o.useEffect(()=>{f(!1)},[f]);const $=o.useCallback(n=>{n!==a&&h(n)},[a,h]);v(`favorites-${s==null?void 0:s.id}-${e==null?void 0:e.id}`,()=>Q(s==null?void 0:s.id,e==null?void 0:e.id),{enabled:!!(s!=null&&s.id)&&!!(e!=null&&e.id)});const L=o.useCallback(async n=>{await W(s==null?void 0:s.id,e==null?void 0:e.id,n),await m.invalidateQueries(`favorites-${s==null?void 0:s.id}-${e==null?void 0:e.id}`)},[s==null?void 0:s.id,e==null?void 0:e.id,m]),M=o.useMemo(()=>a?`${S}/search/movie?api_key=${b}&language=${i}&query=${a}`:K(i).topRatedMovies,[a,i]),R=o.useMemo(()=>a?`${S}/search/tv?api_key=${b}&language=${i}&query=${a}`:O(i).topRatedSeries,[a,i]),{data:d,isLoading:T}=v([a,"search-movies"],()=>y(M)),{data:u,isLoading:B}=v([a,"search-series"],()=>y(R)),C=T||B,x=o.useMemo(()=>{var g,j;const n=((g=d==null?void 0:d.results)==null?void 0:g.filter(r=>r.backdrop_path&&r.poster_path))||[],p=((j=u==null?void 0:u.results)==null?void 0:j.filter(r=>r.backdrop_path&&r.poster_path))||[];return[...n,...p].sort(()=>Math.random()-.5)},[d==null?void 0:d.results,u==null?void 0:u.results]);if(C)return t.jsx("div",{className:"contenedor",children:t.jsx(E,{logoBuscar:!0,menu:!0,perfil:!0,condicionExpanded:!0})});const _=n=>n.map((p,g)=>t.jsx(Y,{item:p,onAddFavorite:()=>L(p)},g)),k=()=>x.length>0?t.jsx("div",{className:"contenedorItemsBuscar",children:_(x)}):t.jsx("div",{className:"contenedorItemsNoE",children:t.jsxs("p",{children:["La búsqueda de ",a," no arrojó coincidencias."]})});return t.jsxs("div",{className:"contenedor",children:[t.jsx(E,{perfil:!0,menu:!0,logoBuscar:!0,condicionExpanded:!0}),t.jsxs("div",{className:"contenedorBuscar",children:[c<900&&t.jsx(G,{placeholder:"Search movies, series, tv series...",onSubmit:$}),k()]})]})}export{D as default};
